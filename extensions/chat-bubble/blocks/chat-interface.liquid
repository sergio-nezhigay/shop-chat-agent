{{ 'chat.css' | asset_url | stylesheet_tag }}
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<div class="shop-chat-interface">
  <div class="shop-chat-options">
    <div class="shop-chat-option ai-option ">
      <button class=" shop-ai-chat-bubble">AI Chat</button>
    </div>

    <div class="shop-chat-option viber-option">
      <a
        href="viber://chat?number=+380507025777"
        target="_blank"
        class="shop-viber-trigger"
      >
        Viber
      </a>
    </div>
    <div class="shop-chat-option telegram-option">
      <a
        href="https://t.me/NSergiy"
        target="_blank"
        class="shop-telegram-trigger"
      >
        Telegram
      </a>
    </div>
  </div>
  <button
    class="shop-chat-main-bubble"
    id="chatToggle"
    aria-label="{{ 'chat.toggle_label' | t | default: 'Toggle chat menu' }}"
  >
    üí¨
  </button>
  <div class="shop-ai-chat-container">
    <div class="shop-ai-chat-window">
      <div class="shop-ai-chat-header">
        <div>{{ 'chat.title' | t }}</div>
        <button class="shop-ai-chat-close">‚úï</button>
      </div>
      <div class="shop-ai-chat-messages"></div>
      <div class="shop-ai-chat-input">
        <input type="text" placeholder="{{ 'chat.inputPlaceholder' | t }}">
        <button class="shop-ai-chat-send">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>

<script src="{{ 'chat.js' | asset_url }}" defer></script>
<script>
  window.shopChatConfig = {
    promptType: {{ block.settings.system_prompt | json }},
    welcomeMessage: {{ block.settings.welcome_message | json }}
  };
  window.shopId = {{ shop.id }};

  console.log('[ShopChat Debug] Config:', window.shopChatConfig);
  console.log('[ShopChat Debug] Shop ID:', window.shopId);

  fetch('https://api.ipify.org?format=json')
    .then(response => response.json())
    .then data => {
      console.log('[ShopChat Debug] User IP:', data.ip);
      if (data.ip !== '93.175.232.45') {
        console.log('[ShopChat Debug] Hiding AI option for IP:', data.ip);
        var aiOption = document.querySelector('.shop-chat-option.ai-option');
        if (aiOption) aiOption.style.display = 'none';
      }
    })
    .catch(err => {
      console.warn('[ShopChat Debug] Failed to fetch IP:', err);
    });
</script>

{% schema %}
{
  "name": "AI + Viber Chat",
  "target": "body",
  "settings": [
    {
      "type": "text",
      "id": "welcome_message",
      "label": "Welcome Message",
      "default": "üëã –ü—Ä–∏–≤—ñ—Ç! –ß–∏–º –º–æ–∂—É —Ç–æ–±—ñ –¥–æ–ø–æ–º–æ–≥—Ç–∏ —Å—å–æ–≥–æ–¥–Ω—ñ?"
    },
    {
      "type": "select",
      "id": "system_prompt",
      "label": "System Prompt",
      "options": [
        { "value": "standardAssistant", "label": "Standard Assistant" },
        { "value": "enthusiasticAssistant", "label": "Enthusiastic Assistant" }
      ],
      "default": "standardAssistant"
    }
  ]
}
{% endschema %}
